<div class="container" dir="rtl">

  <!-- Form Card -->
  <div class="card form-card">
    <h2>{{ editMode ? 'ุชุนุฏูู ุงููุชุณุงุจู' : 'ุฅุถุงูุฉ ูุชุณุงุจู' }}</h2>
    <form [formGroup]="competitorForm" (ngSubmit)="submit()">
      
      <div class="form-row">
        <div class="form-group">
          <label>ุงูุงุณู ุงูุฃูู *</label>
          <input type="text" formControlName="firstName" placeholder="ุฃุฏุฎู ุงูุงุณู ุงูุฃูู" />
          <span class="error" *ngIf="competitorForm.get('firstName')?.invalid && competitorForm.get('firstName')?.touched">
            ุงูุงุณู ุงูุฃูู ูุทููุจ
          </span>
        </div>
        
        <div class="form-group">
          <label>ุงูููุจ *</label>
          <input type="text" formControlName="lastName" placeholder="ุฃุฏุฎู ุงูููุจ" />
          <span class="error" *ngIf="competitorForm.get('lastName')?.invalid && competitorForm.get('lastName')?.touched">
            ุงูููุจ ูุทููุจ
          </span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label>ุงูุนูุฑ *</label>
          <input type="number" formControlName="age" placeholder="ุฃุฏุฎู ุงูุนูุฑ" min="5" />
          <span class="error" *ngIf="competitorForm.get('age')?.invalid && competitorForm.get('age')?.touched">
            ุงูุนูุฑ ูุทููุจ (5 ุณููุงุช ุนูู ุงูุฃูู)
          </span>
        </div>

        <div class="form-group select-wrapper">
          <label>ุงูุฌูุณ *</label>
          <select formControlName="gender" required>
            <option value="" disabled selected>ุงุฎุชุฑ ุงูุฌูุณ</option>
            <option value="ุฐูุฑ">ุฐูุฑ</option>
            <option value="ุฃูุซู">ุฃูุซู</option>
          </select>
          <span class="error" *ngIf="competitorForm.get('gender')?.invalid && competitorForm.get('gender')?.touched">
            ุงูุฌูุณ ูุทููุจ
          </span>
        </div>
      </div>

      <div class="form-row select-wrapper">
        <div class="form-group">
          <label>ุงููุฑุน (ุงููุฏุฑุณุฉ) *</label>
          <select formControlName="branch" required>
            <option value="" disabled selected>ุงุฎุชุฑ ุงููุฑุน</option>
            <option *ngFor="let b of branches" [value]="b._id">{{ b.name }}</option>
          </select>
          <span class="error" *ngIf="competitorForm.get('branch')?.invalid && competitorForm.get('branch')?.touched">
            ุงููุฑุน ูุทููุจ
          </span>
        </div>
      </div>

      <div class="form-row select-wrapper">
        <div class="form-group">
          <label>ูู ุณูุฑุฉ *</label>
          <select formControlName="surahFrom" required>
            <option value="" disabled selected>ุงุฎุชุฑ ุงูุณูุฑุฉ ุงูุฃููู</option>
            <option *ngFor="let surah of surahs" [value]="surah">{{ surah }}</option>
          </select>
          <span class="error" *ngIf="competitorForm.get('surahFrom')?.invalid && competitorForm.get('surahFrom')?.touched">
            ุงูุณูุฑุฉ ุงูุฃููู ูุทููุจุฉ
          </span>
        </div>

        <div class="form-group">
          <label>ุฅูู ุณูุฑุฉ *</label>
          <select formControlName="surahTo" required>
            <option value="" disabled selected>ุงุฎุชุฑ ุงูุณูุฑุฉ ุงูุฃุฎูุฑุฉ</option>
            <option *ngFor="let surah of surahs" [value]="surah">{{ surah }}</option>
          </select>
          <span class="error" *ngIf="competitorForm.get('surahTo')?.invalid && competitorForm.get('surahTo')?.touched">
            ุงูุณูุฑุฉ ุงูุฃุฎูุฑุฉ ูุทููุจุฉ
          </span>
        </div>
      </div>

      <div class="form-buttons">
        <button type="submit" class="btn primary" [disabled]="competitorForm.invalid">
          {{ editMode ? 'ุชุญุฏูุซ' : 'ุฅุถุงูุฉ' }}
        </button>
        <button type="button" class="btn secondary" (click)="resetForm()">ุฅูุบุงุก</button>
      </div>
    </form>
  </div>

  <!-- Filters -->
  <div class="filters">
    <input type="text" placeholder="ุจุญุซ ุจุงูุงุณู..." [(ngModel)]="filters.query" (ngModelChange)="applyFilters()" />
    <input type="number" placeholder="ุงูุนูุฑ" [(ngModel)]="filters.age" (ngModelChange)="applyFilters()" min="5" />
    
    <div class="select-wrapper">
      <select [(ngModel)]="filters.gender" (ngModelChange)="applyFilters()">
        <option value="">ูู ุงูุฌูุณูู</option>
        <option value="ุฐูุฑ">ุฐูุฑ</option>
        <option value="ุฃูุซู">ุฃูุซู</option>
      </select>
    </div>

    <div class="select-wrapper">
      <select [(ngModel)]="filters.branch" (ngModelChange)="applyFilters()">
        <option value="">ูู ุงููุฑูุน</option>
        <option *ngFor="let b of branches" [value]="b._id">{{ b.name }}</option>
      </select>
    </div>

    <button type="button" class="btn secondary" (click)="resetFilters()">ุฅุนุงุฏุฉ ุชุนููู</button>
    <button class="btn small primary" (click)="printTable()">๐จ๏ธ ุทุจุงุนุฉ</button>
  </div>

  <!-- Competitors Table -->
  <div class="card table-card">
    <h2>ูุงุฆูุฉ ุงููุชุณุงุจููู</h2>
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>ุงูุงุณู ุงููุงูู</th>
            <th>ุงูุนูุฑ</th>
            <th>ุงูุฌูุณ</th>
            <th>ุงููุฑุน</th>
            <th>ููุฏุงุฑ ุงูุญูุธ</th>
            <th>ุงูุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let c of filteredCompetitors">
            <td>{{ c.firstName }} {{ c.lastName }}</td>
            <td>{{ c.age }}</td>
            <td>{{ c.gender }}</td>
            <td>{{ getBranchName(c.branch) }}</td>
            <td>{{ c.surahRange?.from }} - {{ c.surahRange?.to }}</td>
            <td>
              <button class="btn small primary" (click)="edit(c)">ุชุนุฏูู</button>
              <button class="btn small danger" (click)="delete(c._id)">ุญุฐู</button>
            </td>
          </tr>
          <tr *ngIf="competitors.length === 0">
            <td colspan="7" style="text-align: center;">ูุง ุชูุฌุฏ ุจูุงูุงุช</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
