<div
  class="container"
  dir="rtl"
  style="
    padding: 20px;
    max-width: 1200px;
    margin: 0 auto;
    background: #ffffff;
    min-height: 100vh;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  "
>
  <!-- Teacher Header -->
  <div
    style="
      background: linear-gradient(135deg, #2d8c4a, #1b5e20);
      color: #ffffff;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
    "
  >
    <h1 style="margin: 0 0 8px 0; font-size: 28px; font-weight: 600">
      Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ {{ currentUser?.firstName }} {{ currentUser?.lastName }}
    </h1>
    <p style="margin: 0; opacity: 0.9; font-size: 16px">
      Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù„Ø¬Ù†Ø© Ø§Ù„ØªØ­ÙƒÙŠÙ… - Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒÙ„ÙØ© Ø¨Ù‡Ø§
    </p>
  </div>

  <!-- Back Button (Show only when assignment is selected) -->
  <div *ngIf="selectedAssignment" style="margin-bottom: 20px">
    <button
      style="
        background: #666;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s ease;
        margin-bottom: 16px;
      "
      (click)="backToTasks()"
      (mouseenter)="onBackButtonHover($event, true)"
      (mouseleave)="onBackButtonHover($event, false)"
    >
      â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù‡Ø§Ù…
    </button>
  </div>

  <!-- Results Button -->
  <div *ngIf="selectedAssignment" style="text-align: left; margin-bottom: 20px">
    <div
      style="
        display: flex;
        align-items: center;
        gap: 12px;
        justify-content: flex-end;
        width: 100%;
      "
    >
      <button
        style="
          background: #1b5e20;
          color: white;
          border: none;
          padding: 12px 24px;
          border-radius: 8px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          transition: background 0.3s ease, opacity 0.2s ease;
        "
        (click)="checkAndShowResults()"
        [disabled]="!canShowResults || !selectedAssignment?.categoryId"
        [style.opacity]="
          !canShowResults || !selectedAssignment?.categoryId ? '0.6' : '1'
        "
        [style.cursor]="
          !canShowResults || !selectedAssignment?.categoryId
            ? 'not-allowed'
            : 'pointer'
        "
        (mouseenter)="onTaskCardHover($event, true)"
        (mouseleave)="onTaskCardHover($event, false)"
        title="Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± ÙØ¦Ø©/Ù…Ù‡Ù…Ø© Ù‚Ø¨Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©"
      >
        Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
      </button>

      <span
        *ngIf="!selectedAssignment?.categoryId"
        style="color: #d32f2f; font-size: 14px"
      >
        Ø§Ø®ØªØ± ÙØ¦Ø© Ø£ÙˆÙ„Ø§Ù‹
      </span>
    </div>

    <div
      *ngIf="resultsMessage"
      style="color: #d32f2f; margin-top: 8px; font-size: 14px"
    >
      {{ resultsMessage }}
    </div>
  </div>

  <!-- Tasks Section (Hidden when assignment is selected) -->
  <div *ngIf="!selectedAssignment" style="margin-bottom: 32px">
    <h2
      style="
        color: #1b5e20;
        font-size: 20px;
        font-weight: 600;
        margin-bottom: 16px;
        padding-bottom: 8px;
        border-bottom: 2px solid #e8f5e9;
      "
    >
      Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒÙ„ÙØ© Ù„ÙŠ
    </h2>

    <div
      *ngIf="assignments.length === 0"
      style="text-align: center; padding: 40px 20px; color: #666666"
    >
      <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5">ğŸ“‹</div>
      <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‡Ø§Ù… Ø­Ø§Ù„ÙŠØ§Ù‹</h3>
      <p>Ù„Ù… ÙŠØªÙ… ØªØ¹ÙŠÙŠÙ†Ùƒ ÙÙŠ Ø£ÙŠ Ù…Ù‡Ù…Ø© ØªØ­ÙƒÙŠÙ… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>
    </div>

    <div
      style="
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 16px;
      "
    >
      <div
        *ngFor="let assignment of assignments"
        [style]="{
          background:
            selectedAssignment?._id === assignment._id ? '#e8f5e9' : '#ffffff',
          border:
            selectedAssignment?._id === assignment._id
              ? '1px solid #2d8c4a'
              : '1px solid #e0e0e0',
          'border-radius': '12px',
          padding: '20px',
          cursor: 'pointer',
          transition: 'all 0.3s ease',
          'box-shadow': '0 2px 12px rgba(0, 0, 0, 0.08)'
        }"
        (click)="openAssignment(assignment)"
        (mouseenter)="onTaskCardHover($event, true)"
        (mouseleave)="onTaskCardHover($event, false)"
      >
        <div
          style="
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
          "
        >
          <h3
            style="
              font-size: 18px;
              font-weight: 600;
              color: #1b5e20;
              margin: 0;
              flex: 1;
            "
          >
            {{ assignment.competitionId?.title || "Ù…Ø³Ø§Ø¨Ù‚Ø©" }}
          </h3>
          <span
            style="
              background: #2d8c4a;
              color: #ffffff;
              padding: 4px 12px;
              border-radius: 20px;
              font-size: 12px;
              font-weight: 500;
            "
            >Ù…Ù‡Ù…Ø© Ù†Ø´Ø·Ø©</span
          >
        </div>

        <div style="color: #666666; font-size: 14px; margin-bottom: 12px">
          <div>
            <strong>Ø§Ù„ÙØ¦Ø©:</strong>
            {{
              assignment.competitionCategoryId?.categoryId?.name ||
                assignment.categoryId?.name ||
                "-"
            }}
            â€” {{ assignment.competitionCategoryId?.ageGroupId?.name }}
            {{ assignment.subCategory }}
            <span *ngIf="assignment.competitionCategoryId?.gender">
              â€”
              {{
                assignment.competitionCategoryId?.gender === "male"
                  ? "Ø°ÙƒÙˆØ±"
                  : assignment.competitionCategoryId?.gender === "female"
                  ? "Ø¥Ù†Ø§Ø«"
                  : assignment.competitionCategoryId?.gender
              }}
            </span>
          </div>
          <div><strong>Ø§Ù„Ù‚Ø§Ø¹Ø©:</strong> {{ assignment.classRoom || "-" }}</div>
        </div>

        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px">
          <span
            *ngFor="let member of assignment.juryMembers"
            style="
              background: #f5f5f5;
              color: #333333;
              padding: 4px 8px;
              border-radius: 6px;
              font-size: 12px;
              border-left: 3px solid #4caf50;
            "
          >
            {{ member.userId?.firstName }} {{ member.userId?.lastName }} ({{
              member.role
            }})
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Competitors Section (Show only when assignment is selected) -->
  <div *ngIf="selectedAssignment">
    <!-- Current Assignment Info -->
    <div
      style="
        background: #e8f5e9;
        border: 1px solid #2d8c4a;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
      "
    >
      <h3 style="color: #1b5e20; margin: 0 0 8px 0; font-size: 18px">
        {{ selectedAssignment.competitionId?.title || "Ù…Ø³Ø§Ø¨Ù‚Ø©" }}
      </h3>
      <div style="color: #666666; font-size: 14px">
        <div>
          <strong>Ø§Ù„ÙØ¦Ø©:</strong>
          {{
            selectedAssignment.competitionCategoryId?.categoryId?.name ||
              selectedAssignment.categoryId?.name ||
              "-"
          }}
          â€” {{ selectedAssignment.competitionCategoryId?.ageGroupId?.name }}
          <span *ngIf="selectedAssignment.competitionCategoryId?.gender">
            â€”
            {{
              selectedAssignment.competitionCategoryId?.gender === "male"
                ? "Ø°ÙƒÙˆØ±"
                : selectedAssignment.competitionCategoryId?.gender === "female"
                ? "Ø¥Ù†Ø§Ø«"
                : selectedAssignment.competitionCategoryId?.gender
            }}
          </span>
        </div>
        <div>
          <strong>Ø§Ù„Ù‚Ø§Ø¹Ø©:</strong> {{ selectedAssignment.classRoom || "-" }}
        </div>
      </div>
    </div>

    <div
      *ngFor="let block of subcategoryBlocks"
      style="
        background: #ffffff;
        border-radius: 12px;
        padding: 24px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.08);
        margin-bottom: 24px;
      "
    >
      <div style="margin-bottom: 20px">
        <h2
          style="
            color: #1b5e20;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e8f5e9;
          "
        >
          Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙˆÙ† - {{ block.cc?.categoryId?.name || "-" }}
          <span *ngIf="block.cc?.ageGroupId?.name">
            â€” {{ block.cc?.ageGroupId?.name }}
          </span>
          <span *ngIf="block.cc?.gender">
            â€”
            {{
              block.cc?.gender === "male"
                ? "Ø°ÙƒÙˆØ±"
                : block.cc?.gender === "female"
                ? "Ø¥Ù†Ø§Ø«"
                : block.cc?.gender
            }}
          </span>
        </h2>
        <p style="color: #666666; font-size: 14px; margin-top: 8px">
          Ø§Ù„Ù‚Ø§Ø¹Ø©: {{ selectedAssignment.classRoom }}
        </p>
      </div>

      <div
        *ngIf="block.participants.length === 0"
        style="text-align: center; padding: 40px 20px; color: #666666"
      >
        <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.5">ğŸ‘¥</div>
        <h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒØ§Øª</h3>
        <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø´Ø§Ø±ÙƒØ§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø© Ø§Ù„ÙØ±Ø¹ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹</p>
      </div>

      <div
        style="
          display: grid;
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 16px;
          margin-top: 16px;
        "
      >
        <div
          *ngFor="let participant of block.participants"
          style="
            background: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
          "
          (click)="openMarkModal(participant)"
          (mouseenter)="onCompetitorCardHover($event, true)"
          (mouseleave)="onCompetitorCardHover($event, false)"
        >
          <div
            style="
              width: 60px;
              height: 60px;
              background: linear-gradient(135deg, #2d8c4a, #4caf50);
              border-radius: 50%;
              margin: 0 auto 12px;
              display: flex;
              align-items: center;
              justify-content: center;
              color: #ffffff;
              font-size: 20px;
              font-weight: 600;
            "
          >
            {{ getInitials(participant) }}
          </div>

          <h4
            style="
              font-size: 16px;
              font-weight: 600;
              color: #333333;
              margin-bottom: 4px;
            "
          >
            {{ participant.competitorId?.firstName }}
            {{ participant.competitorId?.lastName }}
          </h4>

          <div style="font-size: 12px; color: #666666; margin-bottom: 12px">
            #{{ participant._id | slice : 0 : 8 }}
          </div>

          <button
            style="
              background: #2d8c4a;
              color: #ffffff;
              border: none;
              padding: 8px 16px;
              border-radius: 6px;
              font-size: 14px;
              cursor: pointer;
              transition: background 0.3s ease;
              width: 100%;
            "
            (mouseenter)="onMarkButtonHover($event, true)"
            (mouseleave)="onMarkButtonHover($event, false)"
          >
            {{ isMarked(participant) ? "ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù…Ø©" : "ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø©" }}
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Marking Modal -->
  <div
    *ngIf="markModalOpen"
    style="
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    "
  >
    <div
      style="
        background: #ffffff;
        border-radius: 16px;
        width: 95%;
        max-width: 1000px;
        max-height: 90vh;
        overflow-y: auto;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      "
    >
      <!-- Modal Header -->
      <div
        style="
          background: linear-gradient(135deg, #2d8c4a, #1b5e20);
          color: #ffffff;
          padding: 24px;
          border-radius: 16px 16px 0 0;
          display: flex;
          justify-content: space-between;
          align-items: center;
        "
      >
        <h2 style="margin: 0; font-size: 24px; font-weight: 600">
          ÙˆØ¶Ø¹ Ø¹Ù„Ø§Ù…Ø© Ù„Ù„Ù…Ø´Ø§Ø±Ùƒ
        </h2>
        <button
          style="
            background: none;
            border: none;
            color: #ffffff;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
          "
          (click)="closeMarkModal()"
          (mouseenter)="onCloseButtonHover($event, true)"
          (mouseleave)="onCloseButtonHover($event, false)"
        >
          Ã—
        </button>
      </div>

      <!-- Modal Body -->
      <div style="padding: 24px">
        <div *ngIf="selectedParticipation">
          <!-- Participant Info -->
          <div
            style="
              text-align: center;
              margin-bottom: 24px;
              padding: 16px;
              background: #e8f5e9;
              border-radius: 8px;
            "
          >
            <h3 style="margin: 0 0 8px 0; color: #1b5e20">
              {{ selectedParticipation.competitorId?.firstName }}
              {{ selectedParticipation.competitorId?.lastName }}
            </h3>
            <p style="margin: 0; color: #666666; font-size: 14px">
              Ø±Ù‚Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©: #{{ selectedParticipation._id }}
            </p>
          </div>

          <!-- Loading State -->
          <div
            *ngIf="loadingMark"
            style="text-align: center; padding: 40px; color: #666666"
          >
            Ø¬Ø§Ø±Ù ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ù„Ø§Ù…Ø©...
          </div>

          <!-- Marking Form -->
          <form
            *ngIf="!loadingMark"
            [formGroup]="markForm"
            (ngSubmit)="submitMark()"
          >
            <!-- Summary Cards -->
            <div
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 16px;
                margin-bottom: 24px;
              "
            >
              <div
                #summaryCard1
                style="
                  background: #ffffff;
                  border: 1px solid #e0e0e0;
                  border-radius: 10px;
                  padding: 20px;
                  text-align: center;
                  transition: transform 0.3s ease;
                "
                (mouseenter)="onSummaryCardHover(summaryCard1, true)"
                (mouseleave)="onSummaryCardHover(summaryCard1, false)"
              >
                <div
                  style="font-size: 14px; color: #666666; margin-bottom: 8px"
                >
                  Ø­Ø§ØµÙ„ Ø§Ù„Ø­ÙØ¸
                </div>
                <div
                  style="
                    font-size: 24px;
                    font-weight: 700;
                    color: #1b5e20;
                    margin-bottom: 4px;
                  "
                >
                  {{ memorizationTotalPreview }}
                </div>
                <div style="font-size: 12px; color: #666666">/ 70</div>
              </div>

              <div
                #summaryCard2
                style="
                  background: #ffffff;
                  border: 1px solid #e0e0e0;
                  border-radius: 10px;
                  padding: 20px;
                  text-align: center;
                  transition: transform 0.3s ease;
                "
                (mouseenter)="onSummaryCardHover(summaryCard2, true)"
                (mouseleave)="onSummaryCardHover(summaryCard2, false)"
              >
                <div
                  style="font-size: 14px; color: #666666; margin-bottom: 8px"
                >
                  Ø­Ø§ØµÙ„ Ø§Ù„ØªØ¬ÙˆÙŠØ¯
                </div>
                <div
                  style="
                    font-size: 24px;
                    font-weight: 700;
                    color: #1b5e20;
                    margin-bottom: 4px;
                  "
                >
                  {{ tajweedTotalPreview }}
                </div>
                <div style="font-size: 12px; color: #666666">/ 25</div>
              </div>

              <div
                #summaryCard3
                style="
                  background: #ffffff;
                  border: 1px solid #e0e0e0;
                  border-radius: 10px;
                  padding: 20px;
                  text-align: center;
                  transition: transform 0.3s ease;
                "
                (mouseenter)="onSummaryCardHover(summaryCard3, true)"
                (mouseleave)="onSummaryCardHover(summaryCard3, false)"
              >
                <div
                  style="font-size: 14px; color: #666666; margin-bottom: 8px"
                >
                  Ø§Ù„Ø£Ø¯Ø§Ø¡
                </div>
                <div
                  style="
                    font-size: 24px;
                    font-weight: 700;
                    color: #1b5e20;
                    margin-bottom: 4px;
                  "
                >
                  {{ performanceScorePreview }}
                </div>
                <div style="font-size: 12px; color: #666666">/ 5</div>
              </div>

              <div
                #summaryCard4
                style="
                  background: linear-gradient(135deg, #e8f5e9, #c8e6c9);
                  border: 1px solid #4caf50;
                  border-radius: 10px;
                  padding: 20px;
                  text-align: center;
                  transition: transform 0.3s ease;
                "
                (mouseenter)="onSummaryCardHover(summaryCard4, true)"
                (mouseleave)="onSummaryCardHover(summaryCard4, false)"
              >
                <div
                  style="font-size: 14px; color: #666666; margin-bottom: 8px"
                >
                  Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
                </div>
                <div
                  style="
                    font-size: 24px;
                    font-weight: 700;
                    color: #1b5e20;
                    margin-bottom: 4px;
                  "
                >
                  {{ currentTotal }}
                </div>
                <div style="font-size: 12px; color: #666666">/ 100</div>
              </div>
            </div>

            <!-- Performance Selection -->
            <div
              style="
                display: flex;
                align-items: center;
                gap: 12px;
                margin: 20px 0;
                padding: 16px;
                background: #f5f5f5;
                border-radius: 8px;
              "
            >
              <label style="font-weight: 600; color: #1b5e20"
                >ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø£Ø¯Ø§Ø¡:</label
              >
              <select
                formControlName="performanceLevel"
                style="
                  padding: 8px 12px;
                  border: 1px solid #e0e0e0;
                  border-radius: 6px;
                  background: #ffffff;
                "
              >
                <option value="Ù…ØªÙˆØ³Ø·">Ù…ØªÙˆØ³Ø· - 3/5</option>
                <option value="Ø­Ø³Ù†">Ø­Ø³Ù† - 4/5</option>
                <option value="Ù…Ù…ØªØ§Ø²">Ù…Ù…ØªØ§Ø² - 5/5</option>
              </select>
            </div>

            <!-- Score Table -->
            <!-- Score Table -->
            <div
              style="
                background: #ffffff;
                border: 1px solid #e0e0e0;
                border-radius: 10px;
                overflow: hidden;
                margin-bottom: 20px;
              "
            >
              <div style="overflow-x: auto">
                <div class="score-table-wrap">
                  <table
                    dir="rtl"
                    style="
                      width: 100%;
                      border-collapse: collapse;
                      text-align: center;
                      font-family: 'Cairo', sans-serif;
                      color: #333;
                    "
                  >
                    <thead>
                      <tr>
                        <th
                          rowspan="2"
                          style="
                            background: #f9f9f9;
                            border: 1px solid #ccc;
                            padding: 8px;
                            min-width: 140px;
                          "
                        >
                          Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù„Ù‚Ø¨
                        </th>
                        <th
                          colspan="4"
                          style="
                            background: #fff6cc;
                            border: 1px solid #ccc;
                            padding: 8px;
                            font-weight: bold;
                          "
                        >
                          ØªÙ‚ÙŠÙŠÙ… Ø§Ù„Ø­ÙØ¸ (70)
                        </th>
                        <th
                          colspan="8"
                          style="
                            background: #f0f0f0;
                            border: 1px solid #ccc;
                            padding: 8px;
                            font-weight: bold;
                          "
                        >
                          ØªÙ‚ÙŠÙŠÙ… Ø§Ù„ØªØ¬ÙˆÙŠØ¯ (25)
                        </th>
                        <th
                          rowspan="2"
                          style="
                            background: #fff6cc;
                            border: 1px solid #ccc;
                            padding: 8px;
                            font-weight: bold;
                          "
                        >
                          Ø§Ù„Ø£Ø¯Ø§Ø¡ (5)
                        </th>
                        <th
                          rowspan="2"
                          style="
                            background: #d9ead3;
                            border: 1px solid #ccc;
                            padding: 8px;
                            font-weight: bold;
                          "
                        >
                          Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹
                        </th>
                      </tr>

                      <tr>
                        <!-- memorization subheaders -->
                        <th
                          style="
                            background: #fffbe6;
                            border: 1px solid #ccc;
                            padding: 6px;
                          "
                        >
                          ØªÙ†Ø¨ÙŠÙ‡<br />(0.5)
                        </th>
                        <th
                          style="
                            background: #fffbe6;
                            border: 1px solid #ccc;
                            padding: 6px;
                          "
                        >
                          ÙØªØ­<br />(1.5)
                        </th>
                        <th
                          style="
                            background: #fffbe6;
                            border: 1px solid #ccc;
                            padding: 6px;
                          "
                        >
                          ØªØ±Ø¯Ø¯<br />(0.25)
                        </th>
                        <th
                          style="
                            background: #ffe6e6;
                            border: 1px solid #ccc;
                            padding: 6px;
                            font-weight: bold;
                          "
                        >
                          Ø®ØµÙ… Ø§Ù„Ø­ÙØ¸
                        </th>

                        <!-- tajweed subheaders -->
                        <th
                          style="
                            background: #f7f7f7;
                            border: 1px solid #ccc;
                            padding: 6px;
                          "
                        >
                          Ø§Ù„ØºÙ†Ø©
                        </th>
                        <th
                          style="
                            background: #f7f7f7;
                            border: 1px solid #ccc;
                            padding: 6px;
                          "
                        >
                          Ø§Ù„Ù…Ø¯ÙˆØ¯
                        </th>
                        <th
                          style="
                            background: #f7f7f7;
                            border: 1px solid #ccc;
                            padding: 6px;
                          "
                        >
                          Ø§Ù„Ù…Ø®Ø§Ø±Ø¬
                        </th>
                        <th
                          style="
                            background: #f7f7f7;
                            border: 1px solid #ccc;
                            padding: 6px;
                          "
                        >
                          Ø§Ù„ØµÙØ§Øª
                        </th>
                        <th
                          style="
                            background: #f7f7f7;
                            border: 1px solid #ccc;
                            padding: 6px;
                          "
                        >
                          Ø£ØµÙˆÙ„ Ø§Ù„Ø±ÙˆØ§ÙŠØ©
                        </th>
                        <th
                          style="
                            background: #f7f7f7;
                            border: 1px solid #ccc;
                            padding: 6px;
                          "
                        >
                          Ø£Ø®Ø±Ù‰
                        </th>
                        <th
                          style="
                            background: #ffe6e6;
                            border: 1px solid #ccc;
                            padding: 6px;
                            font-weight: bold;
                          "
                        >
                          Ø®ØµÙ… Ø§Ù„ØªØ¬ÙˆÙŠØ¯
                        </th>
                        <th
                          style="
                            background: #e6f4ff;
                            border: 1px solid #ccc;
                            padding: 6px;
                            font-weight: bold;
                          "
                        >
                          Ø­Ø§ØµÙ„ Ø§Ù„ØªØ¬ÙˆÙŠØ¯
                        </th>
                      </tr>
                    </thead>

                    <tbody formArrayName="questions">
                      <tr
                        *ngFor="let qCtrl of questions.controls; let i = index"
                        [formGroupName]="i"
                      >
                        <td
                          style="
                            border: 1px solid #ccc;
                            padding: 6px;
                            background: #f9f9f9;
                          "
                        >
                          Ø³Ø¤Ø§Ù„ {{ qCtrl.get("questionNumber")?.value }}
                        </td>

                        <!-- memorization counters -->
                        <td style="border: 1px solid #ccc; padding: 4px">
                          <div class="counter">
                            <button
                              (click)="decreaseMistake(i, 'tanbih')"
                              [disabled]="
                                isConfirmed || !isPresidentForSelected
                              "
                              type="button"
                            >
                              âˆ’
                            </button>
                            <input
                              type="number"
                              formControlName="tanbih"
                              [value]="
                                qCtrl.get('memorization')?.get('tanbih')?.value
                              "
                              readonly
                            />
                            <button
                              (click)="increaseMistake(i, 'tanbih')"
                              [disabled]="
                                isConfirmed || !isPresidentForSelected
                              "
                              type="button"
                            >
                              +
                            </button>
                          </div>
                        </td>

                        <td style="border: 1px solid #ccc; padding: 4px">
                          <div class="counter">
                            <button
                              (click)="decreaseMistake(i, 'fath')"
                              [disabled]="
                                isConfirmed || !isPresidentForSelected
                              "
                              type="button"
                            >
                              âˆ’
                            </button>
                            <input
                              type="number"
                              [value]="
                                qCtrl.get('memorization')?.get('fath')?.value
                              "
                              readonly
                            />
                            <button
                              (click)="increaseMistake(i, 'fath')"
                              [disabled]="
                                isConfirmed || !isPresidentForSelected
                              "
                              type="button"
                            >
                              +
                            </button>
                          </div>
                        </td>

                        <td style="border: 1px solid #ccc; padding: 4px">
                          <div class="counter">
                            <button
                              (click)="decreaseMistake(i, 'taradud')"
                              [disabled]="
                                isConfirmed || !isPresidentForSelected
                              "
                              type="button"
                            >
                              âˆ’
                            </button>
                            <input
                              type="number"
                              [value]="
                                qCtrl.get('memorization')?.get('taradud')?.value
                              "
                              readonly
                            />
                            <button
                              (click)="increaseMistake(i, 'taradud')"
                              [disabled]="
                                isConfirmed || !isPresidentForSelected
                              "
                              type="button"
                            >
                              +
                            </button>
                          </div>
                        </td>

                        <td
                          style="
                            border: 1px solid #ccc;
                            padding: 4px;
                            background: #ffe6e6;
                            color: #c00;
                            font-weight: bold;
                          "
                        >
                          {{ perQuestionMemDeduction(i) | number : "1.2-2" }}
                        </td>

                        <!-- tajweed fields -->
                        <td
                          *ngFor="
                            let t of [
                              'ghunna',
                              'mad',
                              'makharij',
                              'sifat',
                              'usul',
                              'other'
                            ]
                          "
                          style="border: 1px solid #ccc; padding: 4px"
                        >
                          <div class="counter">
                            <button
                              (click)="decreaseTaj(i, t)"
                              [disabled]="isConfirmed"
                              type="button"
                            >
                              âˆ’
                            </button>
                            <input
                              type="number"
                              [value]="qCtrl.get('tajweed')?.get(t)?.value"
                              readonly
                            />
                            <button
                              (click)="increaseTaj(i, t)"
                              [disabled]="isConfirmed"
                              type="button"
                            >
                              +
                            </button>
                          </div>
                        </td>

                        <td
                          style="
                            border: 1px solid #ccc;
                            background: #ffe6e6;
                            color: #c00;
                            font-weight: bold;
                          "
                        >
                          {{ perQuestionTajDeduction(i) | number : "1.2-2" }}
                        </td>

                        <td
                          style="
                            border: 1px solid #ccc;
                            background: #e6f4ff;
                            font-weight: bold;
                          "
                        >
                          {{ perQuestionTajScore(i) | number : "1.2-2" }} /
                          {{ tajMaxPerQuestion() }}
                        </td>

                        <td style="border: 1px solid #ccc; background: #fffbe6">
                          â€”
                        </td>

                        <td
                          style="
                            border: 1px solid #ccc;
                            background: #d9ead3;
                            font-weight: bold;
                          "
                        >
                          {{ perQuestionRowTotal(i) | number : "1.2-2" }}
                        </td>
                      </tr>
                    </tbody>

                    <!-- Footer / totals -->
                    <tfoot>
                      <tr style="background: #f8f8f8; font-weight: bold">
                        <td
                          style="
                            border: 1px solid #ccc;
                            padding: 6px;
                            text-align: center;
                          "
                        >
                          Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙƒÙ„ÙŠ
                        </td>
                        <td
                          colspan="3"
                          style="border: 1px solid #ccc; padding: 6px"
                        >
                          ØªÙ†Ø¨ÙŠÙ‡: {{ totalCounters("memorization", "tanbih") }} |
                          ÙØªØ­: {{ totalCounters("memorization", "fath") }} |
                          ØªØ±Ø¯Ø¯: {{ totalCounters("memorization", "taradud") }}
                        </td>
                        <td
                          style="
                            border: 1px solid #ccc;
                            background: #ffe6e6;
                            color: #c00;
                          "
                        >
                          Ø®ØµÙ… Ø§Ù„Ø­ÙØ¸:
                          {{
                            computeDeductions().memDeductions | number : "1.2-2"
                          }}
                        </td>

                        <td
                          colspan="6"
                          style="border: 1px solid #ccc; padding: 6px"
                        >
                          ØºÙ†Ø©: {{ totalCounters("tajweed", "ghunna") }} | Ù…Ø¯:
                          {{ totalCounters("tajweed", "mad") }} | Ù…Ø®Ø§Ø±Ø¬:
                          {{ totalCounters("tajweed", "makharij") }} | ØµÙØ§Øª:
                          {{ totalCounters("tajweed", "sifat") }} | Ø£ØµÙˆÙ„:
                          {{ totalCounters("tajweed", "usul") }} | Ø£Ø®Ø±Ù‰:
                          {{ totalCounters("tajweed", "other") }}
                        </td>

                        <td
                          style="
                            border: 1px solid #ccc;
                            background: #ffe6e6;
                            color: #c00;
                          "
                        >
                          Ø®ØµÙ… Ø§Ù„ØªØ¬ÙˆÙŠØ¯:
                          {{
                            computeDeductions().tajDeductions | number : "1.2-2"
                          }}
                        </td>

                        <td
                          style="
                            border: 1px solid #ccc;
                            background: #e6f4ff;
                            font-weight: bold;
                          "
                        >
                          Ø­Ø§ØµÙ„ Ø§Ù„ØªØ¬ÙˆÙŠØ¯: {{ tajweedTotalPreview }} / 25
                        </td>

                        <td style="border: 1px solid #ccc; background: #fffbe6">
                          Ø§Ù„Ø£Ø¯Ø§Ø¡: {{ performanceScorePreview }} / 5
                        </td>

                        <td
                          style="
                            border: 1px solid #ccc;
                            background: #d9ead3;
                            font-weight: bold;
                          "
                        >
                          {{ currentTotal }} / 100
                        </td>
                      </tr>

                      <tr>
                        <td
                          colspan="14"
                          style="border: 1px solid #ccc; padding: 6px"
                        >
                          <strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ÙƒÙ„ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ¬ÙˆÙŠØ¯ = 0.25
                          Ù†Ù‚Ø·Ø©. ØªÙ†Ø¨ÙŠÙ‡ = 0.5 ØŒ ÙØªØ­ = 1.5 ØŒ ØªØ±Ø¯Ø¯ = 0.25.
                        </td>
                      </tr>
                    </tfoot>
                  </table>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Modal Actions -->
      <div
        style="
          display: flex;
          justify-content: flex-end;
          gap: 12px;
          padding: 20px;
          background: #f5f5f5;
          border-radius: 0 0 16px 16px;
        "
      >
        <button
          style="
            padding: 10px 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: #f5f5f5;
            color: #333333;
          "
          (click)="closeMarkModal()"
        >
          Ø¥ØºÙ„Ø§Ù‚
        </button>
        <button
          style="
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: #2d8c4a;
            color: #ffffff;
          "
          (click)="submitMark()"
          [disabled]="loadingMark || isConfirmed || !markForm.valid"
        >
          Ø­ÙØ¸
        </button>
        <button
          style="
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            background: #4caf50;
            color: #ffffff;
          "
          (click)="confirmMark()"
          [disabled]="loadingMark || isConfirmed || !markForm.valid"
        >
          ØªØ£ÙƒÙŠØ¯ ÙˆÙ‚ÙÙ„
        </button>
      </div>
    </div>
  </div>
</div>
